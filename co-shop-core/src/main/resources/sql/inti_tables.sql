CREATE SCHEMA CO_SHOP AUTHORIZATION buyer_2000;

SET search_path TO CO_SHOP;

CREATE TABLE GROUPS
(
    ID         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME       VARCHAR(60) NOT NULL,
    START_DATE DATE,
    END_DATE   DATE
);

CREATE TABLE MEMBERS
(
    ID           BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CLIENT_KEY   UUID UNIQUE               NOT NULL,
    DISPLAY_NAME VARCHAR(60),
    CREATED_AT   TIMESTAMPTZ DEFAULT now() NOT NULL
);

CREATE UNIQUE INDEX ux_members_client_key ON MEMBERS (CLIENT_KEY);

CREATE TABLE GROUP_MEMBERS
(
    GROUP_ID  BIGINT NOT NULL REFERENCES GROUPS (ID) ON DELETE CASCADE,
    MEMBER_ID BIGINT NOT NULL REFERENCES MEMBERS (ID) ON DELETE CASCADE,
    PRIMARY KEY (GROUP_ID, MEMBER_ID)
);

CREATE TABLE PRODUCTS
(
    ID   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(60) NOT NULL,
    UNIT VARCHAR(60) NOT NULL
);

CREATE TABLE ITEMS
(
    ID          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME        VARCHAR(60) NOT NULL,
    DESCRIPTION VARCHAR(60),
    UNIT        VARCHAR(60) NOT NULL,
    FK_GROUP    BIGINT NOT NULL REFERENCES GROUPS (ID),
    FK_PRODUCT  BIGINT REFERENCES PRODUCTS (ID)
);

CREATE TABLE REQUESTS
(
    ID           BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FK_ITEM      BIGINT  NOT NULL REFERENCES ITEMS (ID),
    FK_MEMBER    BIGINT  NOT NULL REFERENCES MEMBERS (ID),
    QUANTITY     INTEGER NOT NULL,
    FOR_EVERYONE BOOLEAN NOT NULL DEFAULT false
);

CREATE TABLE COMMITS
(
    ID        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FK_ITEM   BIGINT  NOT NULL REFERENCES ITEMS (ID),
    FK_MEMBER BIGINT  NOT NULL REFERENCES MEMBERS (ID),
    QUANTITY  INTEGER NOT NULL,
    PRICE     NUMERIC(5, 2),
    COMMITTED BOOLEAN NOT NULL DEFAULT false
);

CREATE TABLE PROPOSALS
(
    ID            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FK_ITEM       BIGINT  NOT NULL REFERENCES ITEMS (ID),
    QUANTITY      INTEGER NOT NULL,
    IS_PER_DAY    BOOLEAN NOT NULL DEFAULT false,
    IS_PER_PERSON BOOLEAN NOT NULL DEFAULT false
);

