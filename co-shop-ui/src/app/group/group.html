<div class="frame">
  <header class="header">
    <h1>Einkaufsübersicht</h1>
    <a class="add-button" [routerLink]="'add-item'">+</a>
  </header>

  <div class="items-container">
    <!-- Empty state -->
    @if (store.items().length === 0) {
      <div class="empty-state">
        <p>Keine Artikel gefunden.<br>Fügen Sie Ihren ersten Artikel hinzu!</p>
      </div>
    }

    <!-- Items list -->
    @for (item of store.items(); track item.id) {
      <div class="item-wrapper">
        <!-- Main item row -->
        <div class="item" (click)="toggleItemExpanded(item.id)">
          <div class="item-left">
            <div class="item-name">{{ item.name }}</div>
            <div class="expand-indicator" [class.expanded]="isItemExpanded(item.id)">
              @if (item.requests.length > 0) {
                <span class="chevron">›</span>
              }
            </div>
          </div>
          <div class="item-actions">
            <button class="action-button request-button" (click)="$event.stopPropagation()">
              <span class="star-icon"></span>
            </button>
            <button class="action-button commit-button" (click)="$event.stopPropagation()">
              <span class="commit-icon"></span>
            </button>
            <div class="quantity-display">
              {{ store.getTotalCommitsForItem(item.id) }} / {{ store.getTotalRequestsForItem(item.id) }} {{ item.unit }}
            </div>
          </div>
        </div>

        <!-- Collapsible requests section -->
        @if (isItemExpanded(item.id)) {
          <div class="requests-section">
            @for (request of item.requests; track request.id) {
              <div class="request-item">
                <div class="request-info">
                  <span class="request-member"> {{ store.getMemberNameById(request.memberId) }} </span>
                  <span class="request-quantity">{{ request.qtyRequested }} {{ item.unit }}</span>
                  @if (request.forEveryone) {
                    <span class="for-everyone-tag">Für alle</span>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
